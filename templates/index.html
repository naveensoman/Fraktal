<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Klout</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  </head>
  <body>
    <header class="hero">
      <div class="container">
        <h1>Klout</h1>
        <p class="tagline">A community-powered microblog where the top message is always up for grabs.</p>
      </div>
    </header>

    <main class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <section class="top-bid">
        <h2>Top of Klout</h2>
        {% if leading_bid %}
          <article class="bid-card">
            <h3>{{ leading_bid.message }}</h3>
            <p class="meta">{{ leading_bid.bidder_name }} &middot; Original bid: {{ '%.2f'|format(leading_bid.amount) }} klouts</p>
            <p class="meta">Current decayed value: {{ '%.2f'|format(leading_bid.effective_amount) }} klouts</p>
            <p class="meta">Placed {{ leading_bid.created_at.strftime('%b %d, %Y %H:%M UTC') }}</p>
          </article>
        {% else %}
          <p>No one has claimed the top spot yet. Be the first to leave your mark!</p>
        {% endif %}

        <form class="card" method="post" action="{{ url_for('place_bid') }}">
          <h3>Challenge the top spot</h3>
          <label>
            Display name
            <input type="text" name="bidder_name" required>
          </label>
          <label>
            Your message
            <textarea name="message" rows="3" maxlength="280" required></textarea>
          </label>
          <label>
            Bid amount (klouts)
            <input type="number" name="amount" min="0" step="0.01" required>
          </label>
          {% if leading_bid %}
            <p class="hint">You must beat the current decayed value of {{ '%.2f'|format(leading_bid.effective_amount) }} klouts.</p>
          {% endif %}
          <button type="submit">Place bid</button>
        </form>
      </section>

      <section class="timeline">
        <h2>Live Feed</h2>
        <form class="card" method="post" action="{{ url_for('create_post') }}">
          <h3>Share an update</h3>
          <label>
            Display name
            <input type="text" name="handle" maxlength="40" required>
          </label>
          <label>
            What's happening?
            <textarea name="content" rows="3" maxlength="280" required></textarea>
          </label>
          <button type="submit">Post</button>
        </form>

        <div class="posts">
          {% if posts %}
            {% for post in posts %}
              <article class="post">
                <header>
                  <strong>{{ post.handle }}</strong>
                  <span>{{ post.created_at }}</span>
                </header>
                <p>{{ post.content }}</p>
              </article>
            {% endfor %}
          {% else %}
            <p>No posts yet. Start the conversation!</p>
          {% endif %}
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container">
        <p>Made with ❤️ for the Klout experiment.</p>
      </div>
    </footer>
  </body>
</html>
